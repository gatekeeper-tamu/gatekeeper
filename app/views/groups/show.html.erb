<p id="notice"><%= notice %></p>

<p>
  <strong>Group name:</strong>
  <%= @group.group_name %>
</p>

<p>
  <strong>Owner:</strong>
  <%= @group.owner.username %>
</p>

<p>
  <strong>Members:</strong>
  <table>
    <tr>
      <th colspan="2">Name</th>
      <th>Username</th>
      <th>Email</th>
      <th>Permission</th>
    </tr>
    <% @group.members.each do |member| %>
      <tr>
        <%user = member.user%>
        <td><%= user.first_name%></td>
        <td><%= user.last_name%></td>
        <td><%= link_to "#{user.username}", user_root_path(user.username) %></td>
        <td><%= user.email%></td>
        <td><%= member.permission%></td>
      </tr>
    <% end %>
  </table>
</p>

<p>
  <strong>Subscriptions:</strong>
  <table>
    <tr>
      <th>Owner</th>
      <th>Name</th>
      <th>Username</th>
      <th></th>
    </tr>
    <% @group.subscriptions.each do |subscription| %>
      <tr>
        <td><%= link_to "#{subscription.user.username}", user_root_path(subscription.user.username)%></td>
        <td><%= link_to "#{subscription.subscription_name}", subscription_root_path(subscription.id)%></td>
        <td><%= subscription.username%></td>
        <td>
          <% if current_user == subscription.user || current_user.is_admin?(@group) %>
            <%= link_to "Remove", [@group, group: { subscription_ids: [subscription.id], update_action: "remove"}], method: 'patch' %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
  <% if current_user.is_collaborator?(@group) %>
    <%= render '/groups/add_subscription.html.erb' , resource: @group, resource_name: Group %>
  <% end %>
</p>

<% if current_user.is_admin?(@group) %>
  <%= link_to 'Edit', edit_group_path(@group) %>
<% end %>
<%= link_to 'Back', groups_path %>
